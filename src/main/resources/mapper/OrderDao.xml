<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.qiein.erp.pk.web.dao.OrderDao" >
  <resultMap id="baseMap" type="com.qiein.erp.pk.web.entity.vo.OrderVO">
    <id property="id" column="id"/>
    <result property="orderTime" column="order_time"/>
    <result property="shootTime" column="venue_day"/>
    <result property="planTime" column="staff_day"/>
    <result property="kzPhone" column="KZPHONE"/>
    <result property="kzName" column="KZNAME"/>
    <result property="mateName" column="MATENAME"/>
    <result property="matePhone" column="MATEPHONE"/>
    <result property="address" column="ADDRESS"/>
    <result property="venueId" column="venue_id"/>
    <result property="mealId" column="meal_id"/>
    <result property="mealName" column="meal_name"/>
    <result property="orderType" column="order_type"/>
    <result property="shootId" column="shoot_id"/>
    <result property="shootName" column="shoot_name"/>
    <result property="makeupId" column="makeup_id"/>
    <result property="makeupName" column="makeup_name"/>
    <result property="shootRoomId" column="shootRoomId"/>
  </resultMap>
  <select id="selectOrder" resultMap="baseMap">
    SELECT
        pro.id ,
        ord.order_time ,
        venue_sch.venue_day ,
        plan_sch.staff_day ,
        info.KZPHONE ,
        info.KZNAME ,
        detail.MATENAME ,
        detail.MATEPHONE ,
        detail.ADDRESS ,
        venue_sch.venue_id ,
        meal.id meal_id ,
        meal.meal_name ,
        pro.order_type ,
        staff_sch1.id shoot_id,
        staff1.NICKNAME shoot_name,
        staff_sch2.id makeup_id,
        staff2.NICKNAME makeup_name,
        GROUP_CONCAT(sence_sch.id SEPARATOR ',') shootRoomId
    FROM
        hm_erp_order ord
    LEFT JOIN hm_crm_client_info info ON info.KZID = ord.kzid
    AND info.COMPANYID = ord.company_id
    LEFT JOIN hm_crm_client_detail detail ON info.kzid = detail.kzid
    AND info.COMPANYID = detail.COMPANYID
    LEFT JOIN hm_erp_meal meal ON ord.meal_id = meal.id
    AND ord.company_id = meal.company_id
    LEFT JOIN hm_erp_order_process pro ON ord.id = pro.id
    AND ord.company_id = pro.company_id
    LEFT JOIN hm_erp_process_shoot_schedule shoot_pro ON shoot_pro.process_id = pro.id
    AND shoot_pro.company_id = pro.company_id
    LEFT JOIN hm_erp_process_scene_schedule sence_pro ON sence_pro.process_id = pro.id
    AND sence_pro.company_id = pro.company_id
    LEFT JOIN hm_erp_plan_schedule plan_sch ON shoot_pro.plan_schedule_id = plan_sch.id
    AND shoot_pro.company_id = plan_sch.company_id
    LEFT JOIN hm_erp_scene_schedule sence_sch ON sence_sch.id = sence_pro.shoot_schedule_id
    AND sence_sch.company_id = sence_pro.company_id
    LEFT JOIN hm_erp_venue_schedule venue_sch ON venue_sch.id = shoot_pro.venue_schedule_id
    AND venue_sch.company_id = shoot_pro.company_id
    LEFT JOIN hm_erp_makeup_room_schedule makeup_room_sch ON makeup_room_sch.id = shoot_pro.makeup_room_schedule_id
    AND makeup_room_sch.company_id = shoot_pro.company_id
    LEFT JOIN hm_erp_staff_schedule staff_sch1 ON staff_sch1.id = shoot_pro.shoot_schedule_id
    AND staff_sch1.company_id = shoot_pro.company_id
    LEFT JOIN hm_erp_staff_schedule staff_sch2 ON staff_sch2.id = shoot_pro.shoot_schedule_id
    AND staff_sch2.company_id = shoot_pro.company_id
    LEFT JOIN hm_pub_staff staff1 ON staff1.ID = staff_sch1.staff_id
    AND staff1.COMPANYID = staff_sch1.company_id
    LEFT JOIN hm_pub_staff staff2 ON staff2.ID = staff_sch2.staff_id
    AND staff2.COMPANYID = staff_sch2.company_id
    WHERE
        ord.company_id =#{companyId}
    GROUP BY
	pro.id,
	sence_pro.shoot_schedule_id

  </select>

</mapper>