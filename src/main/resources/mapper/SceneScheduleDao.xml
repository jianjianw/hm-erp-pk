<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.qiein.erp.pk.web.dao.SceneScheduleDao" >



    <resultMap id="BaseResultMap" type="com.qiein.erp.pk.web.entity.po.SceneSchedulePO" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="shoot_id" property="shootId" jdbcType="INTEGER" />
        <result column="scene_id" property="sceneId" jdbcType="INTEGER" />
        <result column="start_time" property="startTime" jdbcType="INTEGER" />
        <result column="end_time" property="endTime" jdbcType="INTEGER" />
        <result column="end_time" property="endTime" jdbcType="INTEGER" />
        <result column="status_id" property="statusId" jdbcType="VARCHAR" />
    </resultMap>

    <resultMap id="sceneSchedule" type="com.qiein.erp.pk.web.entity.po.SceneSchedulePO">
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="shoot_id" property="shootId" jdbcType="INTEGER" />
        <result column="scene_id" property="sceneId" jdbcType="INTEGER" />
        <result column="start_time" property="startTime" jdbcType="INTEGER" />
        <result column="end_time" property="endTime" jdbcType="INTEGER" />
        <result column="end_time" property="endTime" jdbcType="INTEGER" />
        <result column="status_id" property="statusId" jdbcType="VARCHAR" />
        <association property="staffVO" javaType="com.qiein.erp.pk.web.entity.vo.StaffVO">
            <result column="id" property="id"></result>
            <result column="NICKNAME" property="nickName"></result>
        </association>

    </resultMap>

    <select id="selectScheduleByDateTime" parameterType="map" resultMap="sceneSchedule">
      select scene.id,scene.shoot_id,scene.scene_id,scene.start_time,scene.end_time,scene.status_id,scene.status_id, staff.id ,staff.NICKNAME
          from hm_erp_scene_schedule scene
          inner join hm_erp_process_scene_schedule scene_link on scene.id = scene_link.shoot_schedule_id
          and scene.company_id = scene_link.company_id

          inner join hm_erp_process_shoot_schedule shoot_link on shoot_link.process_id = scene_link.process_id
          and shoot_link.company_id = scene_link.company_id

          inner join hm_erp_staff_schedule staff_schedule on staff_schedule.id = shoot_link.shoot_schedule_id
          and staff_schedule.company_id = shoot_link.company_id

          inner join hm_pub_staff staff on staff.ID = staff_schedule.staff_id

      where scene.company_id = #{companyId}
      and  scene.venue_id = #{venueId}
      and scene.start_time BETWEEN #{startTime} AND #{endTime}
    </select>
</mapper>